name: Deploy to GCP Storage

on:
  push:
    branches:
      - main
  workflow_dispatch:

env:
  GCS_BUCKET: simple-secret-santa.com
  LOCAL_ARTIFACT_PATH: index.html
  GCS_DESTINATION_PATH: index.html

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v5

      - name: Setup gcloud
        uses: google-github-actions/setup-gcloud@v2
        with:
          service_account_key: ${{ secrets.GCP_SERVICE_ACCOUNT_KEY }}
          install_components: 'gsutil'

      - name: ðŸ“¤ Upload du fichier vers GCS
        run: |
          LOCAL_FILE="${{ env.LOCAL_ARTIFACT_PATH }}" 
          GCS_URI="gs://${{ env.GCS_BUCKET }}/${{ env.GCS_DESTINATION_PATH }}"
          # gsutil est maintenant configurÃ© pour utiliser les credentials
          gsutil cp "${LOCAL_FILE}" "${GCS_URI}" 
          echo "Done."
